<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Driver Creation Tester</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        h1 { color: #2563EB; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { padding: 12px 24px; margin: 10px 5px; cursor: pointer; background: #2563EB; color: white; border: none; border-radius: 6px; font-size: 14px; }
        button:hover { background: #1d4ed8; }
        .result { padding: 15px; margin: 15px 0; border-radius: 6px; white-space: pre-wrap; font-family: monospace; font-size: 13px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .loading { color: #856404; background: #fff3cd; border: 1px solid #ffeeba; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        label { font-weight: bold; color: #333; }
    </style>
</head>
<body>
    <h1>🚀 Railway Driver Creation Debug Tool</h1>
    <p>Use this tool to diagnose why drivers can't be added on Railway.</p>

    <div class="section">
        <h2>Test 1: System Check</h2>
        <button onclick="testSystem()">Run System Check</button>
        <div id="system-result"></div>
    </div>

    <div class="section">
        <h2>Test 2: Create Driver via Form</h2>
        <form id="driver-form">
            <label>Name:</label>
            <input type="text" name="name" value="Test Driver" required>
            
            <label>Mobile:</label>
            <input type="text" name="mobile" value="09123456789" required>
            
            <label>License Number:</label>
            <input type="text" name="license_number" id="license" required>
            
            <label>Status:</label>
            <select name="status">
                <option value="available">Available</option>
                <option value="on-trip">On Trip</option>
                <option value="off-duty">Off Duty</option>
            </select>
            
            <button type="submit">Create Driver</button>
        </form>
        <div id="form-result"></div>
    </div>

    <div class="section">
        <h2>Test 3: AJAX Test</h2>
        <button onclick="testAjax()">Test AJAX Driver Creation</button>
        <div id="ajax-result"></div>
    </div>

    <script>
        // Generate random license number
        document.getElementById('license').value = 'TEST' + Math.floor(Math.random() * 10000);

        function showResult(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.className = 'result ' + type;
            el.innerHTML = message;
        }

        async function testSystem() {
            showResult('system-result', 'Testing system...', 'loading');
            
            try {
                const response = await fetch('https://it12-prime-mover.up.railway.app/debug/test-driver');
                const data = await response.json();
                
                let output = 'SYSTEM TEST RESULTS:\n\n';
                output += JSON.stringify(data, null, 2);
                
                const isSuccess = data.database && data.database.includes('✓');
                showResult('system-result', output, isSuccess ? 'success' : 'error');
            } catch (error) {
                showResult('system-result', 'Error: ' + error.message, 'error');
            }
        }

        document.getElementById('driver-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            showResult('form-result', 'Creating driver...', 'loading');
            
            try {
                const formData = new FormData(this);
                const response = await fetch('https://it12-prime-mover.up.railway.app/drivers', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('form-result', 'SUCCESS! Driver created:\n' + JSON.stringify(data, null, 2), 'success');
                    document.getElementById('license').value = 'TEST' + Math.floor(Math.random() * 10000);
                } else {
                    showResult('form-result', 'FAILED:\n' + JSON.stringify(data, null, 2), 'error');
                }
            } catch (error) {
                showResult('form-result', 'Error: ' + error.message, 'error');
            }
        });

        async function testAjax() {
            showResult('ajax-result', 'Testing AJAX request...', 'loading');
            
            try {
                const response = await fetch('https://it12-prime-mover.up.railway.app/debug/test-driver-ajax', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        name: 'AJAX Test Driver',
                        mobile: '09987654321',
                        license_number: 'AJAX' + Math.floor(Math.random() * 10000),
                        status: 'available'
                    })
                });
                
                const data = await response.json();
                
                let output = 'AJAX TEST RESULTS:\n\n';
                output += 'Status: ' + response.status + '\n\n';
                output += JSON.stringify(data, null, 2);
                
                showResult('ajax-result', output, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('ajax-result', 'Error: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
